
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>í† ìš”ì¼ ì‹œí—˜ ì‹œê°„ íˆ¬í‘œ</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <meta name="color-scheme" content="light only" />
  <style>
    * { font-family: 'Noto Sans KR', sans-serif; }
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}

    /* í˜„ëŒ€ì ì¸ ìƒ‰ìƒ ìŠ¤í‚¤ë§ˆ */
    .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    .gradient-card { background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); }
    .glass-effect { backdrop-filter: blur(10px); background: rgba(255, 255, 255, 0.9); }

    /* ê°œì„ ëœ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
      transition: all 0.3s ease;
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
    }

    .btn-secondary {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      box-shadow: 0 4px 15px rgba(245, 87, 108, 0.4);
      transition: all 0.3s ease;
    }
    .btn-secondary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(245, 87, 108, 0.6);
    }

    /* ê°œì„ ëœ ì¹´ë“œ ë””ìì¸ */
    .card-modern {
      background: white;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      transition: all 0.3s ease;
    }
    .card-modern:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
    }

    /* ê°œì„ ëœ ìƒíƒœë°” */
    .status-modern {
      border-radius: 12px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      animation: slideIn 0.3s ease-out;
    }

    /* ê°œì„ ëœ ëŒ€í•™ ì„ íƒ ë²„íŠ¼ */
    .univ-btn-modern {
      border-radius: 12px;
      transition: all 0.3s ease;
      border: 2px solid transparent;
      background: white;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    .univ-btn-modern:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
    }
    .univ-selected {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
      color: white !important;
      border-color: transparent !important;
      transform: scale(1.05);
    }

    /* ê°œì„ ëœ ì²´í¬ë°•ìŠ¤ */
    .checkbox-modern {
      position: relative;
      appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 6px;
      border: 2px solid #e2e8f0;
      background: white;
      transition: all 0.3s ease;
      cursor: pointer;
    }
    .checkbox-modern:checked {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-color: transparent;
      box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
    }
    .checkbox-modern:checked::after {
      content: 'âœ“';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 12px;
      font-weight: bold;
    }

    /* ê°œì„ ëœ ì…ë ¥ í•„ë“œ */
    .input-modern {
      border-radius: 12px;
      border: 2px solid #e2e8f0;
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.9);
    }
    .input-modern:focus {
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      background: white;
    }

    /* ìŠ¤í”¼ë„ˆ ì• ë‹ˆë©”ì´ì…˜ */
    .spin{animation:spin 1s linear infinite}
    @keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}

    /* ìŠ¬ë¼ì´ë“œ ì¸ ì• ë‹ˆë©”ì´ì…˜ */
    @keyframes slideIn {
      from { transform: translateY(-10px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    /* í„ìŠ¤ ì• ë‹ˆë©”ì´ì…˜ */
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    .pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }

    /* ê°œì„ ëœ í†µê³„ ì¹´ë“œ */
    .stat-card {
      background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.7) 100%);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.3);
      border-radius: 16px;
      transition: all 0.3s ease;
    }
    .stat-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }

    /* ê°œì„ ëœ í…Œì´ë¸” */
    .table-modern {
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    }
    .table-modern thead {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    .table-modern tbody tr {
      transition: all 0.2s ease;
    }
    .table-modern tbody tr:hover {
      background: rgba(102, 126, 234, 0.05);
      transform: scale(1.01);
    }
  </style>
</head>
<body class="gradient-bg min-h-screen py-8">
  <div class="max-w-6xl mx-auto px-4">
    <!-- ìƒíƒœë°” -->
    <div id="statusBar" class="hidden mb-6 status-modern px-6 py-4 text-sm font-medium"
         role="status" aria-live="polite">
      <div class="flex items-center">
        <i class="fas fa-info-circle mr-3 text-lg"></i>
        <span id="statusContent"></span>
      </div>
    </div>

    <!-- ë©”ì¸ íˆ¬í‘œ ì¹´ë“œ -->
    <div class="card-modern p-8 mb-8">
      <!-- í—¤ë” ì„¹ì…˜ -->
      <div class="text-center mb-8">
        <div class="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full mb-6 shadow-lg">
          <i class="fas fa-vote-yea text-3xl text-white"></i>
        </div>
        <h1 id="votingTitleDisplay" class="text-4xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-3">
          ì‹œí—˜ ì‹œê°„ íˆ¬í‘œ
        </h1>
        <p id="votingDescriptionDisplay" class="text-lg text-gray-600 mb-4">
          í† ìš”ì¼ì— <span class="font-semibold text-red-500">ë¶ˆê°€ëŠ¥í•œ ì‹œê°„ë§Œ</span> ì²´í¬í•´ì£¼ì„¸ìš”
        </p>
        <div id="votePeriod" class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-green-400 to-blue-500 rounded-full text-white text-sm font-medium shadow-lg hidden">
          <i class="fas fa-calendar-alt mr-2"></i>
          íˆ¬í‘œ ê¸°ê°„: <span id="votePeriodText"></span>
        </div>
      </div>

      <!-- ë°˜ë“œì‹œ ì„œë²„ URLë§Œ ì‚¬ìš© -->
      <script>
        const GAS_URL = window.GAS_URL || "https://script.google.com/macros/s/AKfycbwnMdflSp0Ap64lRAGiiGbLC7cvmba-DtIwbU3vAwEatreMeDTiSF2YI3PKLn3vtqBs/exec";
        if (!/^https?:\/\//.test(GAS_URL)) {
          alert("ì„œë²„ URLì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. index.html ìƒë‹¨ì˜ GAS_URLì„ ì„¤ì •í•´ì£¼ì„¸ìš”.");
        }
      </script>

      <form id="voteForm" class="space-y-8" autocomplete="on" novalidate>
        <input type="hidden" id="number" name="number" />

        <!-- ì†Œì† ëŒ€í•™ ì„¹ì…˜ -->
        <section class="bg-gradient-to-br from-blue-50 to-indigo-50 p-6 rounded-2xl border border-blue-100">
          <div class="flex items-center mb-4">
            <i class="fas fa-university text-blue-600 mr-3 text-xl"></i>
            <h3 class="text-xl font-semibold text-gray-800">ì†Œì† ëŒ€í•™ ì„ íƒ</h3>
          </div>
          <div id="univButtons" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-3 mb-4"></div>
          <div id="customUnivWrap" class="mt-4 hidden">
            <label for="customUniv" class="block text-sm font-medium text-gray-700 mb-2">
              <i class="fas fa-plus-circle mr-2 text-blue-500"></i>ê¸°íƒ€(ì§ì ‘ì…ë ¥)
            </label>
            <input type="text" id="customUniv" class="input-modern w-full px-4 py-3 text-gray-700 placeholder-gray-400" placeholder="ì†Œì† ëŒ€í•™ì„ ì…ë ¥í•˜ì„¸ìš”" />
          </div>
          <input type="hidden" id="school" name="school" required />
          <p class="text-sm text-blue-600 mt-3 flex items-center">
            <i class="fas fa-info-circle mr-2"></i>
            ë°˜ë“œì‹œ ìœ„ ë²„íŠ¼ì—ì„œ ì„ íƒí•˜ê±°ë‚˜ 'ê¸°íƒ€'ë¥¼ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤
          </p>
        </section>

        <!-- ê°œì¸ ì •ë³´ ì…ë ¥ ì„¹ì…˜ -->
        <section class="bg-gradient-to-br from-purple-50 to-pink-50 p-6 rounded-2xl border border-purple-100">
          <div class="flex items-center mb-4">
            <i class="fas fa-user text-purple-600 mr-3 text-xl"></i>
            <h3 class="text-xl font-semibold text-gray-800">ê°œì¸ ì •ë³´ ì…ë ¥</h3>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="space-y-2">
              <label for="name" class="block text-sm font-medium text-gray-700 flex items-center">
                <i class="fas fa-signature mr-2 text-purple-500"></i>ì„±ëª…
              </label>
              <input type="text" id="name" name="name" required pattern="^[ê°€-í£a-zA-Z\s]{2,30}$" title="2~30ì í•œê¸€/ì˜ë¬¸ìœ¼ë¡œ ì…ë ¥"
                     class="input-modern w-full px-4 py-3 text-gray-700 placeholder-gray-400" placeholder="ì„±ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" />
            </div>
            <div class="space-y-2">
              <label for="studentId" class="block text-sm font-medium text-gray-700 flex items-center">
                <i class="fas fa-id-card mr-2 text-purple-500"></i>í•™ë²ˆ
              </label>
              <input type="text" id="studentId" name="studentId" required pattern="^[A-Za-z0-9-_]{5,20}$" title="5~20ì, ì˜ë¬¸/ìˆ«ì/-/_ ì‚¬ìš© ê°€ëŠ¥"
                     class="input-modern w-full px-4 py-3 text-gray-700 placeholder-gray-400" placeholder="í•™ë²ˆì„ ì…ë ¥í•˜ì„¸ìš”" />
              <p class="text-sm text-purple-600 flex items-center mt-2">
                <i class="fas fa-shield-alt mr-2"></i>
                ì¬íˆ¬í‘œ ë°©ì§€ìš©ìœ¼ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤
              </p>
            </div>
          </div>
        </section>

        <!-- ì‹œê°„ ì„ íƒ ì„¹ì…˜ -->
        <section class="bg-gradient-to-br from-red-50 to-orange-50 p-6 rounded-2xl border border-red-100">
          <div class="flex items-center mb-4">
            <i class="fas fa-clock text-red-600 mr-3 text-xl"></i>
            <h3 id="timeSectionTitle" class="text-xl font-semibold text-gray-800">í† ìš”ì¼ ë¶ˆê°€ëŠ¥í•œ ì‹œê°„</h3>
          </div>
          <div id="timeOptionsGrid" class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <label class="group cursor-pointer">
              <div class="bg-white p-4 rounded-xl border-2 border-gray-200 hover:border-red-300 transition-all duration-300 shadow-sm hover:shadow-md">
                <div class="flex items-center justify-between mb-2">
                  <input type="checkbox" name="time" value="9" class="checkbox-modern" />
                  <span class="text-2xl">ğŸ•˜</span>
                </div>
                <div class="text-center">
                  <div class="text-lg font-semibold text-gray-800">9ì‹œ</div>
                  <div class="text-sm text-gray-500">ë¶ˆê°€ëŠ¥</div>
                </div>
              </div>
            </label>
            <label class="group cursor-pointer">
              <div class="bg-white p-4 rounded-xl border-2 border-gray-200 hover:border-red-300 transition-all duration-300 shadow-sm hover:shadow-md">
                <div class="flex items-center justify-between mb-2">
                  <input type="checkbox" name="time" value="10" class="checkbox-modern" />
                  <span class="text-2xl">ğŸ•™</span>
                </div>
                <div class="text-center">
                  <div class="text-lg font-semibold text-gray-800">10ì‹œ</div>
                  <div class="text-sm text-gray-500">ë¶ˆê°€ëŠ¥</div>
                </div>
              </div>
            </label>
            <label class="group cursor-pointer">
              <div class="bg-white p-4 rounded-xl border-2 border-gray-200 hover:border-red-300 transition-all duration-300 shadow-sm hover:shadow-md">
                <div class="flex items-center justify-between mb-2">
                  <input type="checkbox" name="time" value="11" class="checkbox-modern" />
                  <span class="text-2xl">ğŸ•š</span>
                </div>
                <div class="text-center">
                  <div class="text-lg font-semibold text-gray-800">11ì‹œ</div>
                  <div class="text-sm text-gray-500">ë¶ˆê°€ëŠ¥</div>
                </div>
              </div>
            </label>
            <label class="group cursor-pointer">
              <div class="bg-white p-4 rounded-xl border-2 border-gray-200 hover:border-red-300 transition-all duration-300 shadow-sm hover:shadow-md">
                <div class="flex items-center justify-between mb-2">
                  <input type="checkbox" name="time" value="12" class="checkbox-modern" />
                  <span class="text-2xl">ğŸ•›</span>
                </div>
                <div class="text-center">
                  <div class="text-lg font-semibold text-gray-800">12ì‹œ</div>
                  <div class="text-sm text-gray-500">ë¶ˆê°€ëŠ¥</div>
                </div>
              </div>
            </label>
          </div>
          <p class="text-sm text-red-600 mt-4 flex items-center">
            <i class="fas fa-exclamation-triangle mr-2"></i>
            ìµœì†Œ 1ê°œ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”
          </p>
        </section>

        <!-- íˆ¬í‘œí•˜ê¸° ë²„íŠ¼ -->
        <div class="text-center pt-4">
          <button id="submitBtn" type="submit" class="btn-primary text-white font-bold py-4 px-12 rounded-2xl text-lg shadow-xl disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none">
            <i class="fas fa-vote-yea mr-3 text-xl"></i>
            íˆ¬í‘œí•˜ê¸°
            <i class="fas fa-arrow-right ml-3 text-xl"></i>
          </button>
        </div>

        <p id="formHelp" class="sr-only" aria-live="polite"></p>
      </form>
    </div>

    <!-- íˆ¬í‘œ í˜„í™© ì¹´ë“œ -->
    <div class="card-modern p-8">
      <div class="flex justify-between items-center mb-8">
        <div class="flex items-center">
          <i class="fas fa-chart-bar text-blue-600 mr-3 text-2xl"></i>
          <h2 class="text-2xl font-bold text-gray-800">ì‹¤ì‹œê°„ íˆ¬í‘œ í˜„í™©</h2>
        </div>
        <button id="adminBtn" class="btn-secondary text-white px-6 py-3 rounded-xl text-sm font-medium shadow-lg" title="ê´€ë¦¬ì í˜ì´ì§€ë¡œ ì´ë™">
          <i class="fas fa-cog mr-2"></i>ê´€ë¦¬ì
        </button>
      </div>

      <!-- ëŒ€ì‹œë³´ë“œ í†µê³„ ì¹´ë“œë“¤ -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
        <!-- ì´ íˆ¬í‘œìˆ˜ ì¹´ë“œ -->
        <div class="stat-card p-6 text-center group col-span-1 md:col-span-2 lg:col-span-1">
          <div class="relative">
            <div class="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full mb-4 shadow-lg">
              <i class="fas fa-users text-3xl text-white"></i>
            </div>
            <div class="absolute -top-2 -right-2 bg-gradient-to-r from-pink-500 to-red-500 text-white text-xs font-bold px-2 py-1 rounded-full">
              ì‹¤ì‹œê°„
            </div>
          </div>
          <div class="text-4xl font-bold text-blue-600 mb-2" id="totalCount">0</div>
          <div class="text-sm font-medium text-gray-600 mb-3">ì´ íˆ¬í‘œ ì°¸ì—¬ì</div>
          <div class="w-full bg-blue-100 rounded-full h-2">
            <div class="bg-gradient-to-r from-blue-500 to-blue-600 h-2 rounded-full transition-all duration-1000 ease-out" id="totalProgress" style="width: 0%"></div>
          </div>
        </div>

        <!-- ì‹œê°„ëŒ€ë³„ íˆ¬í‘œ í˜„í™© -->
        <div class="stat-card p-6 group col-span-1 md:col-span-2 lg:col-span-2">
          <h4 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
            <i class="fas fa-clock mr-2 text-purple-600"></i>
            ì‹œê°„ëŒ€ë³„ íˆ¬í‘œ í˜„í™©
          </h4>
          <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
            <div class="text-center">
              <div class="inline-flex items-center justify-center w-12 h-12 bg-gradient-to-br from-orange-400 to-orange-600 rounded-xl mb-2 shadow-md">
                <span class="text-lg">ğŸ•˜</span>
              </div>
              <div class="text-xl font-bold text-orange-600" id="time9Count">0</div>
              <div class="text-xs text-gray-500">9ì‹œ ë¶ˆê°€</div>
            </div>
            <div class="text-center">
              <div class="inline-flex items-center justify-center w-12 h-12 bg-gradient-to-br from-red-400 to-red-600 rounded-xl mb-2 shadow-md">
                <span class="text-lg">ğŸ•™</span>
              </div>
              <div class="text-xl font-bold text-red-600" id="time10Count">0</div>
              <div class="text-xs text-gray-500">10ì‹œ ë¶ˆê°€</div>
            </div>
            <div class="text-center">
              <div class="inline-flex items-center justify-center w-12 h-12 bg-gradient-to-br from-pink-400 to-pink-600 rounded-xl mb-2 shadow-md">
                <span class="text-lg">ğŸ•š</span>
              </div>
              <div class="text-xl font-bold text-pink-600" id="time11Count">0</div>
              <div class="text-xs text-gray-500">11ì‹œ ë¶ˆê°€</div>
            </div>
            <div class="text-center">
              <div class="inline-flex items-center justify-center w-12 h-12 bg-gradient-to-br from-purple-400 to-purple-600 rounded-xl mb-2 shadow-md">
                <span class="text-lg">ğŸ•›</span>
              </div>
              <div class="text-xl font-bold text-purple-600" id="time12Count">0</div>
              <div class="text-xs text-gray-500">12ì‹œ ë¶ˆê°€</div>
            </div>
          </div>

          <!-- ë¯¸ë‹ˆ ì°¨íŠ¸ -->
          <div class="mt-4 pt-4 border-t border-gray-200">
            <div class="flex items-end justify-between h-16 px-2">
              <div class="flex flex-col items-center">
                <div class="w-3 bg-orange-400 rounded-t mb-1 transition-all duration-1000" id="bar9" style="height: 0%"></div>
                <span class="text-xs text-gray-500">9ì‹œ</span>
              </div>
              <div class="flex flex-col items-center">
                <div class="w-3 bg-red-400 rounded-t mb-1 transition-all duration-1000" id="bar10" style="height: 0%"></div>
                <span class="text-xs text-gray-500">10ì‹œ</span>
              </div>
              <div class="flex flex-col items-center">
                <div class="w-3 bg-pink-400 rounded-t mb-1 transition-all duration-1000" id="bar11" style="height: 0%"></div>
                <span class="text-xs text-gray-500">11ì‹œ</span>
              </div>
              <div class="flex flex-col items-center">
                <div class="w-3 bg-purple-400 rounded-t mb-1 transition-all duration-1000" id="bar12" style="height: 0%"></div>
                <span class="text-xs text-gray-500">12ì‹œ</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ìµœê·¼ í™œë™ ë° ì¶”ê°€ ì¸ì‚¬ì´íŠ¸ -->
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
        <!-- ì°¸ì—¬ìœ¨ ì¹´ë“œ -->
        <div class="stat-card p-6">
          <div class="flex items-center justify-between mb-4">
            <h4 class="text-lg font-semibold text-gray-800">ì°¸ì—¬ìœ¨</h4>
            <i class="fas fa-chart-pie text-green-600"></i>
          </div>
          <div class="relative w-24 h-24 mx-auto mb-4">
            <svg class="w-24 h-24 transform -rotate-90" viewBox="0 0 100 100">
              <circle cx="50" cy="50" r="40" stroke="#e5e7eb" stroke-width="8" fill="none"/>
              <circle cx="50" cy="50" r="40" stroke="url(#participationGradient)" stroke-width="8" fill="none"
                      stroke-dasharray="251.2" stroke-dashoffset="0" id="participationCircle"/>
            </svg>
            <defs>
              <linearGradient id="participationGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" stop-color="#10b981"/>
                <stop offset="100%" stop-color="#059669"/>
              </linearGradient>
            </defs>
            <div class="absolute inset-0 flex items-center justify-center">
              <span class="text-lg font-bold text-green-600" id="participationPercent">0%</span>
            </div>
          </div>
          <p class="text-sm text-gray-600 text-center">ì´ ì°¸ì—¬ìœ¨</p>
        </div>

        <!-- ì¸ê¸° ì‹œê°„ëŒ€ -->
        <div class="stat-card p-6">
          <div class="flex items-center justify-between mb-4">
            <h4 class="text-lg font-semibold text-gray-800">ì¸ê¸° ì‹œê°„ëŒ€</h4>
            <i class="fas fa-star text-yellow-600"></i>
          </div>
          <div class="text-center">
            <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-yellow-400 to-yellow-600 rounded-full mb-3">
              <span class="text-2xl" id="popularTimeEmoji">ğŸ•˜</span>
            </div>
            <div class="text-xl font-bold text-gray-800 mb-1" id="popularTime">9ì‹œ</div>
            <div class="text-sm text-gray-600">ê°€ì¥ ì„ í˜¸ë˜ëŠ” ì‹œê°„</div>
          </div>
        </div>

        <!-- ìµœê·¼ íˆ¬í‘œ -->
        <div class="stat-card p-6">
          <div class="flex items-center justify-between mb-4">
            <h4 class="text-lg font-semibold text-gray-800">ìµœê·¼ í™œë™</h4>
            <i class="fas fa-history text-blue-600"></i>
          </div>
          <div class="space-y-2">
            <div class="flex items-center justify-between text-sm">
              <span class="text-gray-600">ì˜¤ëŠ˜ íˆ¬í‘œ</span>
              <span class="font-semibold text-blue-600" id="todayVotes">0</span>
            </div>
            <div class="flex items-center justify-between text-sm">
              <span class="text-gray-600">ì´ë²ˆì£¼ íˆ¬í‘œ</span>
              <span class="font-semibold text-blue-600" id="weekVotes">0</span>
            </div>
            <div class="flex items-center justify-between text-sm">
              <span class="text-gray-600">í‰ê·  íˆ¬í‘œìœ¨</span>
              <span class="font-semibold text-green-600" id="avgParticipation">0%</span>
            </div>
          </div>
        </div>
      </div>

      <!-- íˆ¬í‘œì ëª…ë‹¨ í…Œì´ë¸” -->
      <div class="overflow-x-auto">
        <table class="table-modern w-full">
          <thead>
            <tr>
              <th class="px-6 py-4 text-left font-semibold">
                <i class="fas fa-hashtag mr-2 text-blue-600"></i>ìˆœë²ˆ
              </th>
              <th class="px-6 py-4 text-left font-semibold">
                <i class="fas fa-university mr-2 text-blue-600"></i>ì†Œì†í•™êµ
              </th>
              <th class="px-6 py-4 text-left font-semibold">
                <i class="fas fa-user mr-2 text-blue-600"></i>ì„±ëª…
              </th>
              <th class="px-6 py-4 text-left font-semibold">
                <i class="fas fa-id-card mr-2 text-blue-600"></i>í•™ë²ˆ
              </th>
              <th class="px-6 py-4 text-center font-semibold">9ì‹œ</th>
              <th class="px-6 py-4 text-center font-semibold">10ì‹œ</th>
              <th class="px-6 py-4 text-center font-semibold">11ì‹œ</th>
              <th class="px-6 py-4 text-center font-semibold">12ì‹œ</th>
            </tr>
          </thead>
          <tbody id="voteTable" class="divide-y divide-gray-200"></tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    // ---- ìƒíƒœë°” ìœ í‹¸ ----
    const statusBar = document.getElementById('statusBar');
    const statusContent = document.getElementById('statusContent');
    function showStatus(msg, kind='info'){
      const styles = {
        info:  'bg-gradient-to-r from-blue-400 to-blue-600 text-white border-blue-300',
        ok:    'bg-gradient-to-r from-green-400 to-green-600 text-white border-green-300',
        warn:  'bg-gradient-to-r from-yellow-400 to-yellow-600 text-white border-yellow-300',
        err:   'bg-gradient-to-r from-red-400 to-red-600 text-white border-red-300'
      };
      const icons = {
        info:  'fas fa-info-circle',
        ok:    'fas fa-check-circle',
        warn:  'fas fa-exclamation-triangle',
        err:   'fas fa-times-circle'
      };
      statusBar.className = `status-modern mb-6 px-6 py-4 text-sm font-medium ${styles[kind]||styles.info}`;
      statusContent.innerHTML = msg;
      statusBar.classList.remove('hidden');
    }
    function hideStatus(){ statusBar.classList.add('hidden'); }

    const univButtons = document.getElementById("univButtons");
    const schoolHidden = document.getElementById("school");
    const customWrap = document.getElementById("customUnivWrap");
    const customInput = document.getElementById("customUniv");

    function renderUniversityButtons() {
      univButtons.innerHTML = ''; // ê¸°ì¡´ ë²„íŠ¼ë“¤ ì œê±°
      currentUniversityList.forEach(u=>{
        const btn=document.createElement('button');
        btn.type='button';
        btn.className='univ-btn-modern px-4 py-3 text-sm font-medium text-gray-700';
        btn.innerHTML = u.includes('ê¸°íƒ€')
          ? '<i class="fas fa-plus mr-2"></i>' + u
          : '<i class="fas fa-university mr-2"></i>' + u;
        btn.addEventListener('click',()=>{
          [...univButtons.querySelectorAll('button')].forEach(b=>{
            b.classList.remove('univ-selected');
            b.innerHTML = b.textContent.includes('ê¸°íƒ€')
              ? '<i class="fas fa-plus mr-2"></i>' + b.textContent.replace('<i class="fas fa-plus mr-2"></i>', '').replace('<i class="fas fa-university mr-2"></i>', '')
              : '<i class="fas fa-university mr-2"></i>' + b.textContent.replace('<i class="fas fa-plus mr-2"></i>', '').replace('<i class="fas fa-university mr-2"></i>', '');
          });
          btn.classList.add('univ-selected');
          if(u.includes('ê¸°íƒ€')) {
            customWrap.classList.remove('hidden');
            customInput.focus();
            schoolHidden.value = '';
            btn.innerHTML = '<i class="fas fa-plus mr-2"></i>' + u;
          } else {
            customWrap.classList.add('hidden');
            customInput.value='';
            schoolHidden.value = u;
            btn.innerHTML = '<i class="fas fa-university mr-2"></i>' + u;
          }
        });
        univButtons.appendChild(btn);
      });
    }
    customInput.addEventListener('input',()=>{ schoolHidden.value = customInput.value.trim(); });

    let votes = [];
    async function fetchVotes() {
      showStatus('<i class="fas fa-spinner spin mr-2"></i>ì„œë²„ì— ì—°ê²° ì¤‘ì…ë‹ˆë‹¤...', 'info');
      const controller = new AbortController();
      const timer = setTimeout(()=>controller.abort(), 20000); // 20ì´ˆ íƒ€ì„ì•„ì›ƒ
      try{
        const res = await fetch(GAS_URL, { method: "GET", signal: controller.signal });
        clearTimeout(timer);
        if (!res.ok) throw new Error('ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨');
        const body = await res.json();
        votes = body?.data || [];
        updateTable(); updateStats();

        // íˆ¬í‘œ ê¸°ê°„ í‘œì‹œ
        updateVotePeriod(body?.settings);

        // ë™ì  ì„¤ì • ì ìš©
        updateDynamicSettings(body?.settings);

        // ëŒ€í•™ ëª©ë¡ ì„¤ì •
        if (body?.settings?.universityList && body.settings.universityList.length > 0) {
          currentUniversityList = body.settings.universityList;
          renderUniversityButtons();
        } else {
          // ê¸°ë³¸ê°’ ì„¤ì •
          currentUniversityList = [
            "ê°€í†¨ë¦­ëŒ€í•™êµ", "ê°€í†¨ë¦­ê´€ë™ëŒ€í•™êµ", "ê°€í†¨ë¦­ê½ƒë™ë„¤ëŒ€í•™êµ",
            "ê°€í†¨ë¦­ìƒì§€ëŒ€í•™êµ", "ëŒ€êµ¬ê°€í†¨ë¦­ëŒ€í•™êµ", "ëª©í¬ê°€í†¨ë¦­ëŒ€í•™êµ",
            "ë¶€ì‚°ê°€í†¨ë¦­ëŒ€í•™êµ", "ì„œê°•ëŒ€í•™êµ", "ì¸ì²œê°€í†¨ë¦­ëŒ€í•™êµ", "ê¸°íƒ€(ì§ì ‘ì…ë ¥)"
          ];
          renderUniversityButtons();
        }

        // ì‹œê°„ ë¶ˆê°€ ì„¤ì • ì ìš©
        updateUnavailableTimes(body?.settings?.unavailableTimes);
        showStatus('<i class="fas fa-check mr-2"></i>ì„œë²„ ì—°ê²° ì™„ë£Œ.', 'ok');
        setTimeout(hideStatus, 1200);
      }catch(err){
        clearTimeout(timer);
        showStatus('<i class="fas fa-triangle-exclamation mr-2"></i>ì„œë²„ ì—°ê²° ì‹¤íŒ¨: '+ (err.message||'ì˜¤ë¥˜'), 'err');
      }
    }

    function rowToHtml(v) {
      return `
        <tr class="hover:bg-blue-50 transition-colors duration-200">
          <td class="px-6 py-4 font-medium text-gray-900">${v.number}</td>
          <td class="px-6 py-4 text-gray-700">
            <div class="flex items-center">
              <i class="fas fa-university mr-2 text-blue-500"></i>
              ${v.school}
            </div>
          </td>
          <td class="px-6 py-4 text-gray-700">
            <div class="flex items-center">
              <i class="fas fa-user mr-2 text-purple-500"></i>
              ${v.name}
            </div>
          </td>
          <td class="px-6 py-4 text-gray-700">
            <div class="flex items-center">
              <i class="fas fa-id-card mr-2 text-green-500"></i>
              ${v.studentId}
            </div>
          </td>
          <td class="px-6 py-4 text-center">
            <span class="inline-flex items-center justify-center w-8 h-8 rounded-full ${v.unavailable9 ? 'bg-red-100 text-red-600' : 'bg-green-100 text-green-600'}">
              ${v.unavailable9 ? '<i class="fas fa-times text-sm"></i>' : '<i class="fas fa-check text-sm"></i>'}
            </span>
          </td>
          <td class="px-6 py-4 text-center">
            <span class="inline-flex items-center justify-center w-8 h-8 rounded-full ${v.unavailable10 ? 'bg-red-100 text-red-600' : 'bg-green-100 text-green-600'}">
              ${v.unavailable10 ? '<i class="fas fa-times text-sm"></i>' : '<i class="fas fa-check text-sm"></i>'}
            </span>
          </td>
          <td class="px-6 py-4 text-center">
            <span class="inline-flex items-center justify-center w-8 h-8 rounded-full ${v.unavailable11 ? 'bg-red-100 text-red-600' : 'bg-green-100 text-green-600'}">
              ${v.unavailable11 ? '<i class="fas fa-times text-sm"></i>' : '<i class="fas fa-check text-sm"></i>'}
            </span>
          </td>
          <td class="px-6 py-4 text-center">
            <span class="inline-flex items-center justify-center w-8 h-8 rounded-full ${v.unavailable12 ? 'bg-red-100 text-red-600' : 'bg-green-100 text-green-600'}">
              ${v.unavailable12 ? '<i class="fas fa-times text-sm"></i>' : '<i class="fas fa-check text-sm"></i>'}
            </span>
          </td>
        </tr>`;
    }

    function updateTable() {
      const tbody = document.getElementById("voteTable");
      tbody.innerHTML = votes.map(v => rowToHtml(v)).join("");
    }

    function updateStats() {
      const totalVotes = votes.length;

      // ë™ì  ì‹œê°„ ì˜µì…˜ì— ë§ê²Œ ì¹´ìš´íŠ¸ ê³„ì‚°
      const timeCounts = currentTimeOptions.map(option => {
        const count = votes.filter(v => v[`unavailable${option.id}`]).length;
        return count;
      });

      // ê¸°ë³¸ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
      document.getElementById("totalCount").textContent = totalVotes;

      // ë™ì  ì‹œê°„ ì˜µì…˜ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
      currentTimeOptions.forEach((option, index) => {
        const countElement = document.getElementById(`time${option.id}Count`);
        if (countElement) {
          countElement.textContent = timeCounts[index];
        }
      });

      // ëŒ€ì‹œë³´ë“œ ê¸°ëŠ¥ë“¤
      updateDashboard(totalVotes, ...timeCounts);
    }

    let currentTimeOptions = [];
    let currentUniversityList = [];

    function updateDashboard(total, ...timeCounts) {
      // ì´ íˆ¬í‘œìˆ˜ í”„ë¡œê·¸ë ˆìŠ¤ ë°” ì• ë‹ˆë©”ì´ì…˜
      const maxExpected = 100; // ì˜ˆìƒ ìµœëŒ€ íˆ¬í‘œìˆ˜
      const progressPercent = Math.min((total / maxExpected) * 100, 100);
      setTimeout(() => {
        document.getElementById('totalProgress').style.width = progressPercent + '%';
      }, 100);

      // ë¯¸ë‹ˆ ì°¨íŠ¸ ë°” ì• ë‹ˆë©”ì´ì…˜ (ë™ì  ì‹œê°„ ì˜µì…˜ì— ë§ê²Œ)
      const maxUnavailable = Math.max(...timeCounts, 1);
      setTimeout(() => {
        timeCounts.forEach((count, index) => {
          const barElement = document.getElementById(`bar${index + 9}`);
          if (barElement) {
            barElement.style.height = (count / maxUnavailable) * 100 + '%';
          }
        });
      }, 200);

      // ì°¸ì—¬ìœ¨ ê³„ì‚° ë° í‘œì‹œ
      const participationPercent = total > 0 ? Math.round((total / 50) * 100) : 0; // 50ëª…ì„ ê¸°ì¤€ìœ¼ë¡œ ê³„ì‚°
      document.getElementById('participationPercent').textContent = participationPercent + '%';

      // ì°¸ì—¬ìœ¨ ì›í˜• ì°¨íŠ¸ ì• ë‹ˆë©”ì´ì…˜
      const circumference = 2 * Math.PI * 40; // r=40
      const offset = circumference - (participationPercent / 100) * circumference;
      setTimeout(() => {
        document.getElementById('participationCircle').style.strokeDashoffset = offset;
      }, 300);

      // ì¸ê¸° ì‹œê°„ëŒ€ ê³„ì‚° (ë™ì  ì˜µì…˜ì— ë§ê²Œ)
      const timeCountsWithInfo = timeCounts.map((count, index) => ({
        time: currentTimeOptions[index]?.label || `${9 + index}ì‹œ`,
        count: count,
        emoji: currentTimeOptions[index]?.emoji || 'ğŸ•'
      }));

      // ê°€ì¥ ì ì€ ë¶ˆê°€ ì„ íƒ = ê°€ì¥ ì¸ê¸° ìˆëŠ” ì‹œê°„ëŒ€
      const popularTime = timeCountsWithInfo.reduce((min, current) =>
        current.count < min.count ? current : min
      );

      document.getElementById('popularTime').textContent = popularTime.time;
      document.getElementById('popularTimeEmoji').textContent = popularTime.emoji;

      // ìµœê·¼ í™œë™ ë°ì´í„°
      const today = new Date();
      const todayVotes = votes.filter(v => {
        const voteDate = new Date(v.timestamp);
        return voteDate.toDateString() === today.toDateString();
      }).length;

      const weekStart = new Date(today);
      weekStart.setDate(today.getDate() - 7);
      const weekVotes = votes.filter(v => {
        const voteDate = new Date(v.timestamp);
        return voteDate >= weekStart;
      }).length;

      document.getElementById('todayVotes').textContent = todayVotes;
      document.getElementById('weekVotes').textContent = weekVotes;
      document.getElementById('avgParticipation').textContent = total > 0 ? Math.round((weekVotes / 7) * 100) + '%' : '0%';
    }

    function updateVotePeriod(settings) {
      const periodDiv = document.getElementById("votePeriod");
      const periodText = document.getElementById("votePeriodText");

      if (!settings) {
        periodDiv.classList.add('hidden');
        return;
      }

      const { voteStartDate, voteEndDate, voteStartTime, voteEndTime } = settings;
      let periodStr = '';

      if (voteStartDate && voteEndDate) {
        if (voteStartDate === voteEndDate) {
          periodStr = `${voteStartDate}`;
        } else {
          periodStr = `${voteStartDate} ~ ${voteEndDate}`;
        }
      } else if (voteStartDate) {
        periodStr = `${voteStartDate}ë¶€í„°`;
      } else if (voteEndDate) {
        periodStr = `${voteEndDate}ê¹Œì§€`;
      }

      if (voteStartTime && voteEndTime) {
        periodStr += ` ${voteStartTime} ~ ${voteEndTime}`;
      } else if (voteStartTime) {
        periodStr += ` ${voteStartTime}ë¶€í„°`;
      } else if (voteEndTime) {
        periodStr += ` ${voteEndTime}ê¹Œì§€`;
      }

      if (periodStr.trim()) {
        periodText.textContent = periodStr.trim();
        periodDiv.classList.remove('hidden');
      } else {
        periodDiv.classList.add('hidden');
      }
    }

    function updateDynamicSettings(settings) {
      if (!settings) return;

      // íˆ¬í‘œ ì œëª© ì—…ë°ì´íŠ¸
      if (settings.votingTitle) {
        document.getElementById('votingTitleDisplay').textContent = settings.votingTitle;
      }

      // íˆ¬í‘œ ì„¤ëª… ì—…ë°ì´íŠ¸
      if (settings.votingDescription) {
        document.getElementById('votingDescriptionDisplay').textContent = settings.votingDescription;
      }

      // ì‹œê°„ ì˜µì…˜ ì—…ë°ì´íŠ¸
      if (settings.timeOptions && settings.timeOptions.length > 0) {
        currentTimeOptions = settings.timeOptions;
        updateTimeOptions(settings.timeOptions, settings.allowAllAvailable);
        updateMiniChartBars(settings.timeOptions);
      } else {
        // ê¸°ë³¸ê°’ ì„¤ì •
        currentTimeOptions = [
          { id: '9', emoji: 'ğŸ•˜', label: '9ì‹œ', description: 'ë¶ˆê°€ëŠ¥' },
          { id: '10', emoji: 'ğŸ•™', label: '10ì‹œ', description: 'ë¶ˆê°€ëŠ¥' },
          { id: '11', emoji: 'ğŸ•š', label: '11ì‹œ', description: 'ë¶ˆê°€ëŠ¥' },
          { id: '12', emoji: 'ğŸ•›', label: '12ì‹œ', description: 'ë¶ˆê°€ëŠ¥' }
        ];
        updateTimeOptions(currentTimeOptions, settings.allowAllAvailable);
        updateMiniChartBars(currentTimeOptions);
      }

      // ì‹œê°„ ì„¹ì…˜ ì œëª© ì—…ë°ì´íŠ¸
      if (settings.timeOptions && settings.timeOptions.length > 0) {
        const firstOption = settings.timeOptions[0];
        const sectionTitle = `${firstOption.label} ${firstOption.description}`;
        document.getElementById('timeSectionTitle').textContent = sectionTitle;
      }
    }

    function updateTimeOptions(timeOptions, allowAllAvailable) {
      const grid = document.getElementById('timeOptionsGrid');
      grid.innerHTML = '';

      // ëª¨ë“  ì‹œê°„ ê°€ëŠ¥ ì˜µì…˜ ì¶”ê°€
      if (allowAllAvailable) {
        const allAvailableLabel = document.createElement('label');
        allAvailableLabel.className = 'group cursor-pointer';
        allAvailableLabel.innerHTML = `
          <div class="bg-gradient-to-br from-green-50 to-emerald-50 p-4 rounded-xl border-2 border-gray-200 hover:border-green-300 transition-all duration-300 shadow-sm hover:shadow-md">
            <div class="flex items-center justify-between mb-2">
              <input type="checkbox" name="allAvailable" class="checkbox-modern" />
              <span class="text-2xl">âœ…</span>
            </div>
            <div class="text-center">
              <div class="text-lg font-semibold text-green-600">ëª¨ë“  ì‹œê°„ ê°€ëŠ¥</div>
              <div class="text-sm text-gray-500">ê°€ëŠ¥</div>
            </div>
          </div>
        `;
        grid.appendChild(allAvailableLabel);

        // ëª¨ë“  ì‹œê°„ ê°€ëŠ¥ ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
        const allAvailableCheckbox = allAvailableLabel.querySelector('input[name="allAvailable"]');
        allAvailableCheckbox.addEventListener('change', function() {
          const timeCheckboxes = grid.querySelectorAll('input[name="time"]:not(:disabled)');
          timeCheckboxes.forEach(cb => {
            if (this.checked) {
              cb.checked = false;
            }
          });
        });
      }

      // ì‹œê°„ ì˜µì…˜ë“¤ ì¶”ê°€
      timeOptions.forEach(option => {
        const label = document.createElement('label');
        label.className = 'group cursor-pointer';
        label.innerHTML = `
          <div class="bg-white p-4 rounded-xl border-2 border-gray-200 hover:border-red-300 transition-all duration-300 shadow-sm hover:shadow-md">
            <div class="flex items-center justify-between mb-2">
              <input type="checkbox" name="time" value="${option.id}" class="checkbox-modern" />
              <span class="text-2xl">${option.emoji}</span>
            </div>
            <div class="text-center">
              <div class="text-lg font-semibold text-gray-800">${option.label}</div>
              <div class="text-sm text-gray-500">${option.description}</div>
            </div>
          </div>
        `;
        grid.appendChild(label);

        // ì‹œê°„ ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸ (ëª¨ë“  ì‹œê°„ ê°€ëŠ¥ê³¼ ì—°ë™)
        const timeCheckbox = label.querySelector('input[name="time"]');
        timeCheckbox.addEventListener('change', function() {
          if (this.checked && allowAllAvailable) {
            const allAvailableCheckbox = grid.querySelector('input[name="allAvailable"]');
            if (allAvailableCheckbox) {
              allAvailableCheckbox.checked = false;
            }
          }
        });
      });
    }

    function updateMiniChartBars(timeOptions) {
      const chartContainer = document.querySelector('.flex.items-end.justify-between.h-16.px-2');
      if (!chartContainer) return;

      chartContainer.innerHTML = '';

      timeOptions.forEach((option, index) => {
        const barContainer = document.createElement('div');
        barContainer.className = 'flex flex-col items-center';
        barContainer.innerHTML = `
          <div class="w-3 bg-orange-400 rounded-t mb-1 transition-all duration-1000" id="bar${option.id}" style="height: 0%"></div>
          <span class="text-xs text-gray-500">${option.label.replace('ì‹œ', '')}</span>
        `;
        chartContainer.appendChild(barContainer);
      });
    }

    function updateUnavailableTimes(unavailableTimes) {
      if (!unavailableTimes) return;

      const timeMap = {
        unavailable9: 'time9',
        unavailable10: 'time10',
        unavailable11: 'time11',
        unavailable12: 'time12'
      };

      Object.entries(timeMap).forEach(([settingKey, inputName]) => {
        const checkbox = document.querySelector(`input[name="time"][value="${inputName.replace('time', '')}"]`);
        const label = checkbox?.closest('label');

        if (checkbox && label) {
          if (unavailableTimes[settingKey]) {
            // ê´€ë¦¬ìê°€ ë¶ˆê°€ëŠ¥ìœ¼ë¡œ ì„¤ì •í•œ ì‹œê°„ì€ ë¹„í™œì„±í™”
            checkbox.disabled = true;
            checkbox.checked = true;
            label.style.opacity = '0.5';
            label.style.pointerEvents = 'none';
            label.title = 'ê´€ë¦¬ìì— ì˜í•´ ì„ íƒí•  ìˆ˜ ì—†ëŠ” ì‹œê°„ì…ë‹ˆë‹¤';
          } else {
            // ê°€ëŠ¥í•œ ì‹œê°„ì€ ì •ìƒ ìƒíƒœë¡œ
            checkbox.disabled = false;
            checkbox.checked = false;
            label.style.opacity = '1';
            label.style.pointerEvents = 'auto';
            label.title = '';
          }
        }
      });
    }

    function validateForm() {
      const name = document.getElementById('name');
      const studentId = document.getElementById('studentId');
      const school = schoolHidden.value.trim();
      const times = Array.from(document.querySelectorAll('input[name="time"]:checked:not(:disabled)')).map(i=>i.value);
      const allAvailable = document.querySelector('input[name="allAvailable"]')?.checked;

      if(!school) { showStatus('ì†Œì† ëŒ€í•™ì„ ì„ íƒí•˜ê±°ë‚˜ ì…ë ¥í•˜ì„¸ìš”.', 'warn'); return false; }
      if(!name.checkValidity()) { showStatus(name.title, 'warn'); name.focus(); return false; }
      if(!studentId.checkValidity()) { showStatus(studentId.title, 'warn'); studentId.focus(); return false; }

      // ëª¨ë“  ì‹œê°„ ê°€ëŠ¥ì´ ì²´í¬ë˜ì–´ ìˆê±°ë‚˜, ë¶ˆê°€ëŠ¥ ì‹œê°„ì´ ì„ íƒë˜ì–´ ìˆì–´ì•¼ í•¨
      if (!allAvailable && times.length === 0) {
        showStatus('ë¶ˆê°€ëŠ¥ ì‹œê°„ì„ ì„ íƒí•˜ê±°ë‚˜ "ëª¨ë“  ì‹œê°„ ê°€ëŠ¥"ì„ ì„ íƒí•˜ì„¸ìš”.', 'warn');
        return false;
      }

      return true;
    }

    document.getElementById("voteForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      if(!validateForm()) return;
      const submitBtn = document.getElementById("submitBtn");
      submitBtn.disabled = true;
      showStatus('<i class="fas fa-spinner spin mr-2"></i>ì œì¶œ ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...', 'info');

      const fd = new FormData(e.target);
      const selectedTimes = fd.getAll("time");
      const allAvailable = fd.get("allAvailable") === "on";

      // ë™ì  ì‹œê°„ ì˜µì…˜ì— ë§ê²Œ ë°ì´í„° êµ¬ì„±
      const payload = {
        action: "create",
        number: null,
        school: (fd.get("school")||"").trim(),
        name: (document.getElementById("name").value||"").trim(),
        studentId: (document.getElementById("studentId").value||"").trim(),
        selectedTimes: selectedTimes,
        allAvailable: allAvailable,
        timestamp: new Date().toISOString()
      };

      // ë™ì  ì‹œê°„ ì˜µì…˜ë“¤ì— ëŒ€í•œ ë¶ˆê°€ ì—¬ë¶€ ì¶”ê°€
      currentTimeOptions.forEach(option => {
        payload[`unavailable${option.id}`] = selectedTimes.includes(option.id);
      });

      try {
        const res = await fetch(GAS_URL, {
          method: "POST",
          // í—¤ë” ë¯¸ì„¤ì • â†’ í”„ë¦¬í”Œë¼ì´íŠ¸ ë°©ì§€
          body: JSON.stringify(payload)
        });
        const out = await res.json();
        if (!res.ok || !out.ok) throw new Error(out.message || "ì œì¶œ ì‹¤íŒ¨");

        e.target.reset();
        [...univButtons.querySelectorAll('button')].forEach(b=>b.classList.remove('univ-selected'));
        customWrap.classList.add('hidden'); schoolHidden.value=''; customInput.value='';

        await fetchVotes();
        showStatus('<i class="fas fa-check mr-2"></i>ì œì¶œì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!', 'ok');
        setTimeout(hideStatus, 1500);
      } catch (err) {
        showStatus('<i class="fas fa-triangle-exclamation mr-2"></i>'+ (err.message || 'ì œì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'), 'err');
      } finally {
        submitBtn.disabled = false;
      }
    });

    document.getElementById("adminBtn").addEventListener("click", () => {
      window.open("admin.html", "_blank");
    });

    // ì´ˆê¸° ë¡œë“œ
    fetchVotes();
  </script>
</body>
</html>
